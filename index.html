<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Personal Dictionary</title>
    <style>
        /* --- CSS STYLING --- */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 700px; margin: 2rem auto; padding: 0 1rem; background-color: #f4f6f8; color: #333; }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 1rem; }
        
        .card { background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); margin-bottom: 1.5rem; }
        
        /* STATS DASHBOARD */
        .stats-container {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            margin-bottom: 2rem; padding: 10px; background: #e3f2fd; 
            border-radius: 12px; border: 1px solid #bbdefb;
        }
        .stat-badge {
            background: white; padding: 5px 12px; border-radius: 20px;
            font-size: 0.85rem; font-weight: 700; color: #495057;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); border: 1px solid #dee2e6;
        }
        .stat-total { background: #007bff; color: white; border-color: #007bff; }

        /* Inputs */
        input, textarea, select { width: 100%; padding: 12px; margin-bottom: 12px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1rem; transition: border 0.3s; }
        input:focus, textarea:focus, select:focus { border-color: #007bff; outline: none; }
        textarea { resize: vertical; height: 80px; font-family: inherit; }
        #customCatInput { display: none; border-color: #17a2b8; background-color: #f0fbff; }

        /* Buttons */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: opacity 0.2s; color: white; }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background-color: #007bff; }
        .btn-warning { background-color: #ffc107; color: #000; }
        .btn-secondary { background-color: #6c757d; margin-top: 5px; display: none; }
        .btn-quiz { background-color: #6f42c1; width: auto; padding: 8px 16px; font-size: 0.9rem; }
        .btn-backup { background-color: #28a745; width: auto; padding: 8px 16px; font-size: 0.9rem; }
        .btn-restore { background-color: #17a2b8; width: auto; padding: 8px 16px; font-size: 0.9rem; }

        .toolbar { display: flex; gap: 10px; flex-wrap: wrap; align-items: center; justify-content: space-between; margin-bottom: 10px; }
        .search-bar { flex-grow: 1; margin-bottom: 0; }

        .word-item { background: white; border-left: 5px solid #007bff; padding: 1.2rem; margin-bottom: 12px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: transform 0.2s; }
        .word-item:hover { transform: translateY(-2px); }

        .word-header { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 8px; }
        .word-title { font-weight: 800; font-size: 1.4rem; color: #2c3e50; }
        .category-badge { background-color: #e9ecef; color: #495057; padding: 4px 10px; border-radius: 15px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase; }
        
        .word-def { color: #555; line-height: 1.6; font-size: 1.05rem; white-space: pre-wrap; }
        .blur-active { filter: blur(6px); cursor: pointer; user-select: none; }
        .blur-active:hover { filter: none; }

        .actions { margin-left: auto; display: flex; gap: 12px; align-items: center; }
        .icon-btn { cursor: pointer; font-size: 1.2rem; transition: transform 0.2s; background: none; border: none; padding: 0; }
        .icon-btn:hover { transform: scale(1.2); }
    </style>
</head>
<body>

    <h1>üìò My Personal Dictionary</h1>

    <div id="statsBoard" class="stats-container"></div>

    <div class="card">
        <h3 id="formTitle" style="margin-top:0;">Add New Word</h3>
        <input type="text" id="newWord" placeholder="Word (e.g., Bitcoin)">
        
        <select id="newCategory" onchange="toggleCustomCategory()">
            <option value="Noun">Noun</option>
            <option value="Verb">Verb</option>
            <option value="Adjective">Adjective</option>
            <option value="Adverb">Adverb</option>
            <option value="Idiom">Idiom</option>
            <option value="Phrasal Verb">Phrasal Verb</option>
            <option value="Other">Other (Type Custom...)</option>
        </select>
        <input type="text" id="customCatInput" placeholder="Type category here (e.g., Finance, Medical)...">

        <textarea id="newDef" placeholder="Meaning and Example Sentence..."></textarea>
        
        <button id="mainBtn" class="btn btn-primary" onclick="handleWordSubmit()">Add Word</button>
        <button id="cancelBtn" class="btn btn-secondary" onclick="resetForm()">Cancel Edit</button>
    </div>

    <div class="toolbar">
        <input type="text" id="searchBox" class="search-bar" placeholder="üîç Search..." onkeyup="filterWords()">
        <button class="btn btn-quiz" onclick="toggleQuizMode()">üôà Quiz</button>
        <button class="btn btn-backup" onclick="downloadData()">üíæ Backup</button>
        <button class="btn btn-restore" onclick="triggerRestore()">üìÇ Restore</button>
        <input type="file" id="restoreInput" style="display: none;" onchange="restoreData(this)">
    </div>

    <div id="dictionaryList"></div>

    <script>
        let dictionary = JSON.parse(localStorage.getItem('myDictionary')) || [];
        let editingId = null; 
        let isQuizMode = false; 

        saveAndRender(); 

        function updateStats() {
            const container = document.getElementById('statsBoard');
            const total = dictionary.length;
            const counts = {};
            dictionary.forEach(item => {
                const cat = item.category;
                counts[cat] = (counts[cat] || 0) + 1;
            });

            let html = `<span class="stat-badge stat-total">üìö Total: ${total}</span>`;
            Object.keys(counts).sort().forEach(cat => {
                html += `<span class="stat-badge">${cat}: ${counts[cat]}</span>`;
            });
            container.innerHTML = html;
        }

        function toggleCustomCategory() {
            const selectBox = document.getElementById('newCategory');
            const customInput = document.getElementById('customCatInput');
            if (selectBox.value === 'Other') {
                customInput.style.display = 'block';
                customInput.focus();
            } else {
                customInput.style.display = 'none';
            }
        }

        function handleWordSubmit() {
            const wordInput = document.getElementById('newWord');
            const selectBox = document.getElementById('newCategory');
            const customInput = document.getElementById('customCatInput');
            const defInput = document.getElementById('newDef');
            
            const word = wordInput.value.trim();
            const definition = defInput.value.trim();
            
            let finalCategory = selectBox.value;
            if (selectBox.value === 'Other') {
                finalCategory = customInput.value.trim();
                if (!finalCategory) { alert("Please type a custom category name!"); return; }
            }

            if (!word || !definition) { alert("Please write both a word and a definition."); return; }

            // --- NEW: DUPLICATE CHECK ---
            // Check if word exists (case-insensitive) AND it's not the word we are currently editing
            const isDuplicate = dictionary.some(item => 
                item.word.toLowerCase() === word.toLowerCase() && item.id !== editingId
            );

            if (isDuplicate) {
                alert("‚ö†Ô∏è This word is already in your dictionary!");
                return; // Stop here, do not save
            }
            // -----------------------------

            if (editingId) {
                const index = dictionary.findIndex(item => item.id === editingId);
                if (index !== -1) dictionary[index] = { id: editingId, word, category: finalCategory, definition };
                editingId = null;
            } else {
                dictionary.push({ id: Date.now(), word, category: finalCategory, definition });
            }

            dictionary.sort((a, b) => a.word.localeCompare(b.word));
            saveAndRender();
            resetForm();
        }

        function editWord(id) {
            const item = dictionary.find(w => w.id === id);
            if (!item) return;

            document.getElementById('newWord').value = item.word;
            document.getElementById('newDef').value = item.definition;

            const selectBox = document.getElementById('newCategory');
            const customInput = document.getElementById('customCatInput');
            let options = Array.from(selectBox.options).map(opt => opt.value);
            
            if (options.includes(item.category)) {
                selectBox.value = item.category;
                customInput.style.display = 'none';
            } else {
                selectBox.value = 'Other';
                customInput.style.display = 'block';
                customInput.value = item.category;
            }

            editingId = id;
            document.getElementById('formTitle').innerText = "Edit Word";
            const mainBtn = document.getElementById('mainBtn');
            mainBtn.innerText = "Update Word";
            mainBtn.className = "btn btn-warning"; 
            document.getElementById('cancelBtn').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteWord(id) {
            if(confirm("Delete this word?")) {
                dictionary = dictionary.filter(item => item.id !== id);
                if (editingId === id) resetForm(); 
                saveAndRender();
            }
        }

        function resetForm() {
            editingId = null;
            document.getElementById('newWord').value = '';
            document.getElementById('newDef').value = '';
            document.getElementById('newCategory').value = 'Noun';
            document.getElementById('customCatInput').value = '';
            document.getElementById('customCatInput').style.display = 'none';
            document.getElementById('formTitle').innerText = "Add New Word";
            const mainBtn = document.getElementById('mainBtn');
            mainBtn.innerText = "Add Word";
            mainBtn.className = "btn btn-primary"; 
            document.getElementById('cancelBtn').style.display = 'none';
        }

        function saveAndRender() {
            localStorage.setItem('myDictionary', JSON.stringify(dictionary));
            updateStats();
            const searchText = document.getElementById('searchBox').value;
            if (searchText) filterWords();
            else renderList(dictionary);
        }

        function renderList(data) {
            const listContainer = document.getElementById('dictionaryList');
            listContainer.innerHTML = ''; 
            if (data.length === 0) { listContainer.innerHTML = '<p style="text-align:center; color:#888;">No words found.</p>'; return; }

            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'word-item';
                const blurClass = isQuizMode ? 'blur-active' : '';
                div.innerHTML = `
                    <div class="word-header">
                        <span class="word-title">${item.word}</span>
                        <button class="icon-btn speak-btn" onclick="speakWord('${item.word}')">üîä</button>
                        <span class="category-badge">${item.category}</span>
                        <div class="actions">
                            <button class="icon-btn edit-btn" onclick="editWord(${item.id})">‚úèÔ∏è</button>
                            <button class="icon-btn delete-btn" onclick="deleteWord(${item.id})">‚ùå</button>
                        </div>
                    </div>
                    <div class="word-def ${blurClass}">${item.definition}</div>
                `;
                listContainer.appendChild(div);
            });
        }

        function filterWords() {
            const searchText = document.getElementById('searchBox').value.toLowerCase();
            const filtered = dictionary.filter(item => 
                item.word.toLowerCase().includes(searchText) || 
                item.category.toLowerCase().includes(searchText)
            );
            renderList(filtered);
        }

        function speakWord(text) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        }

        function toggleQuizMode() {
            isQuizMode = !isQuizMode; 
            saveAndRender();
        }

        function downloadData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dictionary));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "dictionary_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function triggerRestore() { document.getElementById('restoreInput').click(); }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        if(confirm("Replace current list with backup?")) {
                            dictionary = importedData;
                            saveAndRender();
                            alert("Restored Successfully!");
                        }
                    } else { alert("Invalid file format."); }
                } catch (error) { alert("Error reading file."); }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>

