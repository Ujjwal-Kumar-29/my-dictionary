<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultimate Personal Dictionary</title>
    <style>
        /* --- CSS VARIABLES (For Dark Mode Support) --- */
        :root {
            --bg-color: #f4f6f8;
            --text-color: #333;
            --card-bg: #ffffff;
            --input-bg: #ffffff;
            --input-border: #ddd;
            --highlight: #007bff;
            --accent-green: #28a745;
        }

        /* DARK MODE OVERRIDES */
        .dark-mode {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --card-bg: #1e1e1e;
            --input-bg: #2d2d2d;
            --input-border: #444;
            --highlight: #4dabf7;
            --accent-green: #4caf50;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 700px; 
            margin: 2rem auto; 
            padding: 0 1rem; 
            background-color: var(--bg-color); 
            color: var(--text-color); 
            transition: background 0.3s, color 0.3s;
        }

        h1 { text-align: center; margin-bottom: 1rem; position: relative; }

        /* THEME TOGGLE BUTTON (Top Right) */
        .theme-btn {
            position: absolute; top: 0; right: 0;
            background: none; border: none; font-size: 1.5rem; cursor: pointer;
        }

        .card { 
            background: var(--card-bg); 
            padding: 1.5rem; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            margin-bottom: 1.5rem; 
            transition: background 0.3s;
        }
        
        /* STATS DASHBOARD */
        .stats-container {
            display: flex; flex-wrap: wrap; gap: 8px; justify-content: center;
            margin-bottom: 2rem; padding: 10px; 
            background: var(--card-bg); /* Adaptive background */
            border-radius: 12px; border: 1px solid var(--input-border);
        }
        .stat-badge {
            background: var(--bg-color); padding: 5px 12px; border-radius: 20px;
            font-size: 0.85rem; font-weight: 700; color: var(--text-color);
            border: 1px solid var(--input-border);
        }
        .stat-total { background: var(--highlight); color: white; border-color: var(--highlight); }

        /* INPUTS */
        input, textarea, select { 
            width: 100%; padding: 12px; margin-bottom: 12px; 
            background-color: var(--input-bg); color: var(--text-color);
            border: 1px solid var(--input-border); border-radius: 8px; 
            box-sizing: border-box; font-size: 1rem; transition: border 0.3s; 
        }
        input:focus, textarea:focus, select:focus { border-color: var(--highlight); outline: none; }
        textarea { resize: vertical; height: 80px; font-family: inherit; }
        #customCatInput { display: none; border-color: #17a2b8; background-color: rgba(23, 162, 184, 0.1); }

        /* BUTTONS */
        .btn { width: 100%; padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-size: 1rem; font-weight: bold; transition: opacity 0.2s; color: white; }
        .btn:hover { opacity: 0.9; }
        .btn-primary { background-color: var(--highlight); }
        .btn-warning { background-color: #ffc107; color: #000; }
        .btn-secondary { background-color: #6c757d; margin-top: 5px; display: none; }
        .btn-quiz { background-color: #6f42c1; }
        .btn-backup { background-color: var(--accent-green); }
        .btn-restore { background-color: #17a2b8; }
        .btn-random { background-color: #fd7e14; } /* Orange for Random */

        /* TOOLBARS */
        .search-group-container { display: flex; gap: 8px; margin-bottom: 10px; }
        #searchFilter { width: 35%; margin-bottom: 0; cursor: pointer; }
        #searchBox { width: 65%; margin-bottom: 0; }

        .toolbar { display: flex; gap: 8px; flex-wrap: wrap; align-items: center; justify-content: center; margin-bottom: 10px; }
        .toolbar .btn { width: auto; padding: 8px 12px; font-size: 0.9rem; flex-grow: 1; }

        /* WORD ITEMS */
        .word-item { 
            background: var(--card-bg); 
            border-left: 5px solid var(--highlight); 
            padding: 1.2rem; margin-bottom: 12px; border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            transition: transform 0.2s, background 0.3s; 
        }
        .word-item:hover { transform: translateY(-2px); }

        .word-header { display: flex; align-items: center; flex-wrap: wrap; gap: 10px; margin-bottom: 8px; }
        .word-title { font-weight: 800; font-size: 1.4rem; }
        .category-badge { 
            background-color: var(--bg-color); color: var(--text-color); 
            padding: 4px 10px; border-radius: 15px; 
            font-size: 0.75rem; font-weight: 700; text-transform: uppercase; border: 1px solid var(--input-border);
        }
        
        .word-def { line-height: 1.6; font-size: 1.05rem; white-space: pre-wrap; opacity: 0.9; }
        .blur-active { filter: blur(6px); cursor: pointer; user-select: none; }
        .blur-active:hover { filter: none; }

        /* ACTIONS & ICONS */
        .actions { margin-left: auto; display: flex; gap: 12px; align-items: center; }
        .icon-btn { cursor: pointer; font-size: 1.2rem; transition: transform 0.2s; background: none; border: none; padding: 0; }
        .icon-btn:hover { transform: scale(1.2); }
        
        /* Google Icon Color */
        .google-btn { font-size: 1.1rem; filter: grayscale(100%); opacity: 0.7; }
        .google-btn:hover { filter: none; opacity: 1; }

    </style>
</head>
<body>

    <h1>
        üìò My English Master
        <button class="theme-btn" onclick="toggleTheme()" title="Toggle Dark Mode">üåô</button>
    </h1>

    <div id="statsBoard" class="stats-container"></div>

    <div class="card">
        <h3 id="formTitle" style="margin-top:0;">Add New Word</h3>
        <input type="text" id="newWord" placeholder="Word (e.g., Bitcoin)">
        
        <select id="newCategory" onchange="toggleCustomCategory()">
            </select>
        
        <input type="text" id="customCatInput" placeholder="Type category here (e.g., Finance)...">
        <textarea id="newDef" placeholder="Meaning and Example Sentence..."></textarea>
        
        <button id="mainBtn" class="btn btn-primary" onclick="handleWordSubmit()">Add Word</button>
        <button id="cancelBtn" class="btn btn-secondary" onclick="resetForm()">Cancel Edit</button>
    </div>

    <div class="search-group-container">
        <select id="searchFilter" onchange="filterWords()">
            <option value="all">üåê All</option>
            <option value="word">üî§ By Word</option>
            <option value="meaning">üìñ By Meaning</option>
        </select>
        <input type="text" id="searchBox" placeholder="Type to search..." onkeyup="filterWords()">
    </div>

    <div class="toolbar">
        <button class="btn btn-random" onclick="showRandomWord()">üé≤ Random</button>
        <button class="btn btn-quiz" onclick="toggleQuizMode()">üôà Quiz</button>
        <button class="btn btn-backup" onclick="downloadData()">üíæ Backup</button>
        <button class="btn btn-restore" onclick="triggerRestore()">üìÇ Restore</button>
        <input type="file" id="restoreInput" style="display: none;" onchange="restoreData(this)">
    </div>

    <div id="dictionaryList"></div>

    <script>
        // --- 1. SETUP & STATE ---
        let dictionary = JSON.parse(localStorage.getItem('myDictionary')) || [];
        let editingId = null; 
        let isQuizMode = false; 
        const BASE_CATEGORIES = ['Noun', 'Verb', 'Adjective', 'Adverb', 'Idiom', 'Phrasal Verb'];

        // --- 2. INITIALIZATION ---
        // Check for Dark Mode Preference
        if (localStorage.getItem('darkMode') === 'enabled') {
            document.body.classList.add('dark-mode');
            document.querySelector('.theme-btn').innerText = '‚òÄÔ∏è';
        }
        
        saveAndRender(); 

        // --- 3. NEW FEATURE: DARK MODE ---
        function toggleTheme() {
            const body = document.body;
            body.classList.toggle('dark-mode');
            const btn = document.querySelector('.theme-btn');
            
            if (body.classList.contains('dark-mode')) {
                localStorage.setItem('darkMode', 'enabled');
                btn.innerText = '‚òÄÔ∏è'; // Sun icon for light mode
            } else {
                localStorage.setItem('darkMode', 'disabled');
                btn.innerText = 'üåô'; // Moon icon for dark mode
            }
        }

        // --- 4. NEW FEATURE: RANDOM WORD ---
        function showRandomWord() {
            if (dictionary.length === 0) { alert("Add some words first!"); return; }
            
            // Pick random word
            const randomItem = dictionary[Math.floor(Math.random() * dictionary.length)];
            
            // Put it in search box and filter
            document.getElementById('searchBox').value = randomItem.word;
            filterWords();
            
            // Optional: Scroll to it (it will be the only one shown usually)
            window.scrollTo({ top: 300, behavior: 'smooth' });
        }

        // --- 5. DYNAMIC DROPDOWN LOGIC ---
        function renderCategoryDropdown(selectedCategory = null) {
            const selectBox = document.getElementById('newCategory');
            const counts = {};
            dictionary.forEach(item => { counts[item.category] = (counts[item.category] || 0) + 1; });

            let activeCategories = new Set(BASE_CATEGORIES);
            Object.keys(counts).forEach(cat => { if (counts[cat] > 5) activeCategories.add(cat); });

            let sortedCats = Array.from(activeCategories).sort((a, b) => {
                if (a === 'Noun') return -1;
                if (b === 'Noun') return 1;
                const countA = counts[a] || 0;
                const countB = counts[b] || 0;
                if (countB !== countA) return countB - countA; 
                return a.localeCompare(b);
            });

            selectBox.innerHTML = '';
            sortedCats.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat;
                option.text = cat; 
                selectBox.appendChild(option);
            });

            const otherOpt = document.createElement('option');
            otherOpt.value = 'Other';
            otherOpt.text = 'Other (Type Custom...)';
            selectBox.appendChild(otherOpt);

            if (selectedCategory && activeCategories.has(selectedCategory)) {
                selectBox.value = selectedCategory;
                document.getElementById('customCatInput').style.display = 'none';
            } else if (selectedCategory) {
                selectBox.value = 'Other';
                document.getElementById('customCatInput').style.display = 'block';
                document.getElementById('customCatInput').value = selectedCategory;
            } else {
                selectBox.value = 'Noun';
                document.getElementById('customCatInput').style.display = 'none';
            }
        }

        // --- 6. CORE CRUD FUNCTIONS ---
        function handleWordSubmit() {
            const wordInput = document.getElementById('newWord');
            const selectBox = document.getElementById('newCategory');
            const customInput = document.getElementById('customCatInput');
            const defInput = document.getElementById('newDef');
            
            const word = wordInput.value.trim();
            const definition = defInput.value.trim();
            
            let finalCategory = selectBox.value;
            if (selectBox.value === 'Other') {
                finalCategory = customInput.value.trim();
                if (finalCategory) finalCategory = finalCategory.charAt(0).toUpperCase() + finalCategory.slice(1);
                if (!finalCategory) { alert("Please type a custom category name!"); return; }
            }

            if (!word || !definition) { alert("Please write both a word and a definition."); return; }

            const isDuplicate = dictionary.some(item => 
                item.word.toLowerCase() === word.toLowerCase() && item.id !== editingId
            );
            if (isDuplicate) { alert("‚ö†Ô∏è This word is already in your dictionary!"); return; }

            if (editingId) {
                const index = dictionary.findIndex(item => item.id === editingId);
                if (index !== -1) dictionary[index] = { id: editingId, word, category: finalCategory, definition };
                editingId = null;
            } else {
                dictionary.push({ id: Date.now(), word, category: finalCategory, definition });
            }

            dictionary.sort((a, b) => a.word.localeCompare(b.word));
            saveAndRender();
            resetForm();
        }

        function editWord(id) {
            const item = dictionary.find(w => w.id === id);
            if (!item) return;
            document.getElementById('newWord').value = item.word;
            document.getElementById('newDef').value = item.definition;
            renderCategoryDropdown(item.category);
            editingId = id;
            document.getElementById('formTitle').innerText = "Edit Word";
            const mainBtn = document.getElementById('mainBtn');
            mainBtn.innerText = "Update Word";
            mainBtn.className = "btn btn-warning"; 
            document.getElementById('cancelBtn').style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function deleteWord(id) {
            if(confirm("Delete this word?")) {
                dictionary = dictionary.filter(item => item.id !== id);
                if (editingId === id) resetForm(); 
                saveAndRender();
            }
        }

        function resetForm() {
            editingId = null;
            document.getElementById('newWord').value = '';
            document.getElementById('newDef').value = '';
            document.getElementById('customCatInput').value = '';
            document.getElementById('formTitle').innerText = "Add New Word";
            const mainBtn = document.getElementById('mainBtn');
            mainBtn.innerText = "Add Word";
            mainBtn.className = "btn btn-primary"; 
            document.getElementById('cancelBtn').style.display = 'none';
            renderCategoryDropdown(); 
        }

        // --- 7. RENDERING & FILTERING ---
        function saveAndRender() {
            localStorage.setItem('myDictionary', JSON.stringify(dictionary));
            updateStats();
            if (!editingId) renderCategoryDropdown(); 
            // Check if search is active (e.g. random word was just clicked)
            const searchText = document.getElementById('searchBox').value;
            if (searchText) filterWords();
            else renderList(dictionary);
        }

        function renderList(data) {
            const listContainer = document.getElementById('dictionaryList');
            listContainer.innerHTML = ''; 
            if (data.length === 0) { listContainer.innerHTML = '<p style="text-align:center; opacity:0.6;">No words found.</p>'; return; }

            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'word-item';
                const blurClass = isQuizMode ? 'blur-active' : '';
                
                // --- NEW: Added Google Button üîç ---
                div.innerHTML = `
                    <div class="word-header">
                        <span class="word-title">${item.word}</span>
                        <button class="icon-btn speak-btn" onclick="speakWord('${item.word}')">üîä</button>
                        <button class="icon-btn google-btn" onclick="googleWord('${item.word}')" title="Google Search">üîç</button>
                        
                        <span class="category-badge">${item.category}</span>
                        <div class="actions">
                            <button class="icon-btn edit-btn" onclick="editWord(${item.id})">‚úèÔ∏è</button>
                            <button class="icon-btn delete-btn" onclick="deleteWord(${item.id})">‚ùå</button>
                        </div>
                    </div>
                    <div class="word-def ${blurClass}">${item.definition}</div>
                `;
                listContainer.appendChild(div);
            });
        }

        function updateStats() {
            const container = document.getElementById('statsBoard');
            const total = dictionary.length;
            const counts = {};
            dictionary.forEach(item => { counts[item.category] = (counts[item.category] || 0) + 1; });

            let html = `<span class="stat-badge stat-total">üìö Total: ${total}</span>`;
            Object.keys(counts).sort().forEach(cat => {
                html += `<span class="stat-badge">${cat}: ${counts[cat]}</span>`;
            });
            container.innerHTML = html;
        }

        function filterWords() {
            const searchText = document.getElementById('searchBox').value.toLowerCase();
            const filterType = document.getElementById('searchFilter').value;

            const filtered = dictionary.filter(item => {
                const matchWord = item.word.toLowerCase().includes(searchText);
                const matchCat = item.category.toLowerCase().includes(searchText);
                const matchDef = item.definition.toLowerCase().includes(searchText);

                if (filterType === 'word') return matchWord || matchCat;
                if (filterType === 'meaning') return matchDef;
                return matchWord || matchCat || matchDef;
            });
            renderList(filtered);
        }

        // --- 8. UTILITIES ---
        function speakWord(text) {
            window.speechSynthesis.cancel();
            const msg = new SpeechSynthesisUtterance(text);
            msg.lang = 'en-US';
            window.speechSynthesis.speak(msg);
        }

        // --- NEW: Google Search Function ---
        function googleWord(word) {
            const url = `https://www.google.com/search?q=define+${word}`;
            window.open(url, '_blank');
        }

        function toggleQuizMode() {
            isQuizMode = !isQuizMode; 
            saveAndRender();
        }

        function downloadData() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(dictionary));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "dictionary_backup.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
        }

        function triggerRestore() { document.getElementById('restoreInput').click(); }

        function restoreData(input) {
            const file = input.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedData = JSON.parse(e.target.result);
                    if (Array.isArray(importedData)) {
                        if(confirm("Replace current list with backup?")) {
                            dictionary = importedData;
                            saveAndRender();
                            alert("Restored Successfully!");
                        }
                    } else { alert("Invalid file format."); }
                } catch (error) { alert("Error reading file."); }
            };
            reader.readAsText(file);
        }
    </script>
</body>
</html>
